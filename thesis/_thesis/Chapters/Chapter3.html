<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Modelling the dead and what they died from - 3&nbsp; Counting and modelling the dead</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<link href="../Chapters/Chapter4.html" rel="next">
<link href="../Chapters/Chapter2.html" rel="prev">
<link href="../assets/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Chapters/Chapter3.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Counting and modelling the dead</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Modelling the dead and what they died from</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/theorashid/thesis" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">index.html</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Chapters/Chapter2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Background</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Chapters/Chapter3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Counting and modelling the dead</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Chapters/Chapter4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Small: Life expectancy trends in England at the MSOA level</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Chapters/Chapter5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Smaller: Life expectancy inequality in London at the LSOA level</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Chapters/Chapter6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">And what they died from: cause-specific mortality at the district level</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Chapters/Chapter7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">And when they died from cancer: trends in cancer mortality at the district level</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Chapters/Chapter8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Discussion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Appendices/AppendixA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Life table methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Appendices/AppendixB.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Model parameters and priors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Appendices/AppendixC.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Hex-cartogram of life expectancy in 2019 at the MSOA level</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Appendices/AppendixD.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Groups of causes of death</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">3.1</span> Overview</a></li>
  <li><a href="#counts-of-the-dead" id="toc-counts-of-the-dead" class="nav-link" data-scroll-target="#counts-of-the-dead"><span class="header-section-number">3.2</span> Counts of the dead</a>
  <ul class="collapse">
  <li><a href="#geographies-of-england" id="toc-geographies-of-england" class="nav-link" data-scroll-target="#geographies-of-england"><span class="header-section-number">3.2.1</span> Geographies of England</a></li>
  <li><a href="#counts-of-the-living" id="toc-counts-of-the-living" class="nav-link" data-scroll-target="#counts-of-the-living"><span class="header-section-number">3.2.2</span> Counts of the living</a></li>
  <li><a href="#deprivation-data" id="toc-deprivation-data" class="nav-link" data-scroll-target="#deprivation-data"><span class="header-section-number">3.2.3</span> Deprivation data</a></li>
  <li><a href="#migration-data" id="toc-migration-data" class="nav-link" data-scroll-target="#migration-data"><span class="header-section-number">3.2.4</span> Migration data</a></li>
  </ul></li>
  <li><a href="#modelling-the-dead" id="toc-modelling-the-dead" class="nav-link" data-scroll-target="#modelling-the-dead"><span class="header-section-number">3.3</span> Modelling the dead</a></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference"><span class="header-section-number">3.4</span> Inference</a></li>
  <li><a href="#clean-code-and-open-source" id="toc-clean-code-and-open-source" class="nav-link" data-scroll-target="#clean-code-and-open-source"><span class="header-section-number">3.5</span> Clean code and open source</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/theorashid/thesis/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-Chapter3" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Counting and modelling the dead</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="overview" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">3.1</span> Overview</h2>
<p>This chapter presents the datasets, data cleaning, and modelling choices that are common between the proceeding analysis chapters.</p>
</section>
<section id="counts-of-the-dead" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="counts-of-the-dead"><span class="header-section-number">3.2</span> Counts of the dead</h2>
<p>This thesis is primarily concerned with modelling death rates for small areas in England. This requires two data sources: counts of deaths, and populations counts. The counts of deaths come from de-identified civil registration data for all deaths in England from 2002 to 2019. In other words, every death in England from 2002 to 2019.</p>
<p>The data is extracted from the Office for National Statistics (ONS) database and held by SAHSU in a secure environment as individual death records are identifiable data. The data are updated every year and are mostly complete for previous years, but a handful of deaths are registered in later extracts if the ONS have been waiting on coroner’s report to identify the underlying cause of death.</p>
<p>Each record comes with information on postcode of residence, allowing us to assign each death into a spatial unit for analysis. For each analysis, deaths were stratified into the following age groups: 0, 1–4, 5–9, 10–14, then 5-year age groups up to 80–84, and 85 years and older. There are also a series of ICD-10 (International Classification of Diseases, Tenth Revision) codes from the death certificate associated with the underlying and contributory causes leading to the death. Here, I focus only on the underlying cause of death, which has been assigned using selection algorithms to improve consistency between doctors <span class="citation" data-cites="officefornationalstatisticsUserGuideMortality2022">(<a href="../references.html#ref-officefornationalstatisticsUserGuideMortality2022" role="doc-biblioref">Office for National Statistics, 2022a</a>)</span>.</p>
<p>Before fitting any models, it’s good practice to explore the data visually, in this case looking at how total mortality varies over different cross sections: sex, age, space, time.</p>
<div id="fig-ch-3-age" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../thesis-analysis/thesis_analysis/eda/figures/age_mx.webp" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3.1: Age-specific death rates in England from 2002 to 2019.</figcaption>
</figure>
</div>
<p>The general age pattern, after aggregating all years and separating into age groups, follows a J-shape curve, with raised infant and older age mortality (<a href="#fig-ch-3-age">Figure&nbsp;<span>3.1</span></a>). Male mortality is higher at all ages, but particularly in young adulthood (15-29 years) due to injuries resulting from risky behaviour.</p>
<div id="fig-ch-3-age-broad" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../thesis-analysis/thesis_analysis/eda/figures/age_mx_time.webp" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3.2: Age-specific death rates for broad age groups and life expectancy in England from 2002 to 2019.</figcaption>
</figure>
</div>
<p><a href="#fig-ch-3-age-broad">Figure&nbsp;<span>3.2</span></a> looks at the trends over time for wider age groups. I did not use the 5-year age groups because the number of deaths for certain age groups at single years were small, and any data presented should be non-disclosive in accordance with SAHSU’s data sharing agreement. In general, death rates have decreased from 2002 to 2019 in all age groups, but with slowing progress in young adulthood and working ages (30-69 years). Likewise, life expectancy has improved throughout the study period, but has stalled since around 2010 for both sexes.</p>
<div id="fig-ch-3-district" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../thesis-analysis/thesis_analysis/eda/figures/e0_map_LAD_2002_2019.webp" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3.3: District-level life expectancy for total death rates from 2002 to 2019.</figcaption>
</figure>
</div>
<p><a href="#fig-ch-3-district">Figure&nbsp;<span>3.3</span></a> shows the geography of life expectancy after aggregating deaths over the entire study period by district. For both sexes, the picture is similar: pockets of low life expectancy in the urban northwest, northeast, west midlands, and coastal areas east of London.</p>
<p>Here, I have taken slices across each dimension, but the aim in the following chapters is to calculate death rates for each sex-age-space-time stratum.</p>
<section id="geographies-of-england" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="geographies-of-england"><span class="header-section-number">3.2.1</span> Geographies of England</h3>
<p>Having already introduced the term “district” in <a href="#fig-ch-3-district">Figure&nbsp;<span>3.3</span></a>, I’ll set out the lay of the land in terms of geographies used in this thesis. This thesis is concerned only with England, as Scotland, Wales, and Northern Ireland each have their own separate deprivation data which are not comparable. The geographies in England form a nested hierarchy of spatial units from regions to districts to Middle-layer Super Output Areas (MSOAs) to Lower-layer Super Output Areas (LSOAs). The number of units for each geography are summarised in <a href="#tbl-ch-3-geography">Table&nbsp;<span>3.1</span></a>.</p>
<div id="tbl-ch-3-geography" class="anchored">
<table class="table">
<caption>Table&nbsp;3.1: The number of each geographical unit of England used in thesis and their populations in 2019.</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 20%">
<col style="width: 66%">
</colgroup>
<thead>
<tr class="header">
<th>Geography</th>
<th>Number of units</th>
<th>Median (5<sup>th</sup> - 95<sup>th</sup> percentile) population in 2019</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>region</td>
<td>9</td>
<td>5,934,037 (3,536,336-9,092,877)</td>
</tr>
<tr class="even">
<td>district</td>
<td>314</td>
<td>140,271 (68,238-380,483)</td>
</tr>
<tr class="odd">
<td>MSOA</td>
<td>6791</td>
<td>7985 (5760–11,917)</td>
</tr>
<tr class="even">
<td>LSOA</td>
<td>32844</td>
<td>1620 (1235-2468)</td>
</tr>
</tbody>
</table>
</div>
<p>England is divided into 9 regions (London, North West, West Midlands, etc). Within these regions, there are 314 local authority districts. Districts are administrative geographies formed from a mixture of London boroughs, metropolitan and non-metropolitan districts, and unitary authorities. They are responsible for local policies, and are therefore subject to local government restructuring and boundary changes. To ensure geographic consistency, all data were mapped to the district boundaries from 2020.</p>
<p>Output Areas (OAs) are the smallest building block for spatial census statistics, with between 40 and 250 households and typically 100 to 625 people, and are designed to have some socioeconomic homogeneity. LSOAs are a type of census geography made up of around four or five OAs. MSOAs are then comprised of around four or five LSOAs, and these MSOAs fit within district boundaries. OAs, LSOAs, and MSOAs are all statistical units are designed by the ONS purely for analysis purposes, so researchers can use spatial units with similar, but small, population sizes. No policies are created using these boundaries <span class="citation" data-cites="officefornationalstatistics2011CensusGeographies2022">(<a href="../references.html#ref-officefornationalstatistics2011CensusGeographies2022" role="doc-biblioref">Office for National Statistics, 2022b</a>)</span>. Again, for geographic consistency, all data were mapped to the output area hierarchy from the 2011 census.</p>
</section>
<section id="counts-of-the-living" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="counts-of-the-living"><span class="header-section-number">3.2.2</span> Counts of the living</h3>
<p>This second data sources we require are populations counts. These are taken from mid-year population estimates of the usual resident population by the ONS <span class="citation" data-cites="officefornationalstatisticsMiddleLayerSuper2021 officefornationalstatisticsLowerLayerSuper2021">(<a href="../references.html#ref-officefornationalstatisticsMiddleLayerSuper2021" role="doc-biblioref">Office for National Statistics, 2021a</a>, <a href="../references.html#ref-officefornationalstatisticsLowerLayerSuper2021" role="doc-biblioref">2021b</a>)</span>. The ONS estimates inter-censal populations on a rolling basis, updating the previous year’s value using the change in the population in the GP patient registration data as an indicator of the true population change. The LSOA populations are fully consistent with estimates for higher levels in the nested geographical hierarchical including MSOAs, districts, regions and the national total for England <span class="citation" data-cites="officefornationalstatisticsPopulationEstimatesOutput2021">(<a href="../references.html#ref-officefornationalstatisticsPopulationEstimatesOutput2021" role="doc-biblioref">Office for National Statistics, 2021c</a>)</span>.</p>
</section>
<section id="deprivation-data" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="deprivation-data"><span class="header-section-number">3.2.3</span> Deprivation data</h3>
<p>I used data for the following measures of socioeconomic deprivation from the English Indices of Deprivation:</p>
<ul>
<li>Income deprivation (also referred to as <em>poverty</em>). The proportion of the geographical population claiming income-related benefits due to being out of work or having low earnings.</li>
<li>Employment deprivation (also referred to as <em>unemployment</em>). The proportion of the relevant population of the geography involuntarily excluded from the labour market due to unemployment, sickness or disability, or caring responsibilities.</li>
<li>Education, skills and training deprivation (also referred to as <em>low education</em>). Lack of attainment and skills, including education attainment levels, school attendance, and language proficiency indicators in the geographical population.</li>
</ul>
<p>The above measures are the three largest contributors to the Index of Multiple Deprivation (IMD), excluding a domain on health that also uses mortality data. The data are produced at the LSOA level <span class="citation" data-cites="ministryofhousingcommunities&amp;localgovernmentEnglishIndicesDeprivation2019">(<a href="../references.html#ref-ministryofhousingcommunities&amp;localgovernmentEnglishIndicesDeprivation2019" role="doc-biblioref">Ministry of Housing, Communities &amp; Local Government, 2019</a>)</span>.</p>
<p>IMD data are not available for every year. The analysis period for the thesis is 2002 to 2019, so I used data for these measures for 2004, as data for 2002 were not available, and 2019. The 2004 data on deprivation domains were reported for LSOA boundaries from the 2001 census. I mapped these data to the 2011 census LSOA boundaries by assigning the 2001 LSOA score to all postcodes contained within it, then overlaying the 2011 LSOA boundaries, and averaging the score for all constituent postcodes of each LSOA, to obtain the corresponding score for each 2011 LSOA.</p>
<p>The definition of the indicators can change over time. Further, the indicator used for measuring education, skills and training deprivation (low education) is not directly interpretable because it combines multiple concepts and cannot be simply expressed as a proportion of the population. Therefore, I used ranking rather than scores so that comparisons can be made not only across spatial units in a single year, but also across the different years.</p>
<p>The deprivation data for geographies larger than LSOAs in <a href="#tbl-ch-3-geography">Table&nbsp;<span>3.1</span></a> were created by ranking the population-weighted average of scores for all constituent LSOAs, as done previously for districts <span class="citation" data-cites="ministryofhousingcommunities&amp;localgovernmentEnglishIndicesDeprivation2019">(<a href="../references.html#ref-ministryofhousingcommunities&amp;localgovernmentEnglishIndicesDeprivation2019" role="doc-biblioref">Ministry of Housing, Communities &amp; Local Government, 2019</a>)</span>.</p>
</section>
<section id="migration-data" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="migration-data"><span class="header-section-number">3.2.4</span> Migration data</h3>
<p>I also used estimates of population turnover, defined as the proportion of households in each LSOA in 2019 who were different from those who had lived there in 2002, from the Consumer Data Research Centre. The Consumer Data Research Centre estimates these proportions by using the names of households members, individually and in combination, and addresses and dates of records from electoral and consumer registers and land registry sales data <span class="citation" data-cites="vandijkUsingLinkedConsumer2021">(<a href="../references.html#ref-vandijkUsingLinkedConsumer2021" role="doc-biblioref">van Dijk et al., 2021</a>)</span>. Estimates of population turnover for MSOAs were created by taking the mean across all constituent LSOAs <span class="citation" data-cites="ministryofhousingcommunities&amp;localgovernmentEnglishIndicesDeprivation2019">(<a href="../references.html#ref-ministryofhousingcommunities&amp;localgovernmentEnglishIndicesDeprivation2019" role="doc-biblioref">Ministry of Housing, Communities &amp; Local Government, 2019</a>)</span>.</p>
</section>
</section>
<section id="modelling-the-dead" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="modelling-the-dead"><span class="header-section-number">3.3</span> Modelling the dead</h2>
<p>For each chapter, the quantity of interest is the same: mortality in each age group, spatial unit and year. Empirically, death rates can be calculated from observed data as the number of deaths divided by the population in each strata. Formally, using <span class="math inline">\(a\)</span>, <span class="math inline">\(s\)</span>, and <span class="math inline">\(t\)</span> to index age, spatial unit and time respectively, we write <span id="eq-death-rate"><span class="math display">\[
\hat{m}_{ast} = \frac{\text{deaths}_{ast}}{\text{population}_{ast}},
\tag{3.1}\]</span></span> where <span class="math inline">\(\hat{m}_{ast}\)</span> is the death rate.</p>
<p>When the number of deaths becomes small, however, the empirical death rate presents an apparent variability from year to year, or from spatial unit to spatial unit, which is larger than the true differences in the risk of death. The problem is exacerbated for the young ages or rare diseases, where the number of deaths might be zero, or for smaller geographical units, where the population might be zero. As a demonstration, <a href="#fig-ch-3-sim">Figure&nbsp;<span>3.4</span></a> shows the expected and simulated number of deaths for a young age group (1-4 years) and an old age group (80-84). The simulation assumes the hypothetical spatial unit has a population of 1000 in each age group in each year, and generates deaths using a Poisson distribution and the national age-specific death rates for each year. Note, given the population sizes in <a href="#tbl-ch-3-geography">Table&nbsp;<span>3.1</span></a>, the true age-specific populations for LSOAs and MSOAs will be smaller and there will be even more zeros and even more noise in the number of deaths than in this simulation. Although there are a large number of deaths in the older age group and it is easy to visualise a curve that fits the data, the death counts for the young age group are extremely sparse and it is difficult to estimate the true underlying death rate. In this thesis, I have used Bayesian hierarchical models to obtain stable estimates of death rates by sharing information across age groups, spatial units, and years. An added advantage of the Bayesian paradigm is the robust estimation of error.</p>
<div id="fig-ch-3-sim" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../thesis-analysis/thesis_analysis/eda/figures/age_mx_time_sim.webp" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3.4: Simulated and expected deaths from 2002 to 2019 for a young age group (1-4 years) and an old age group (80-84), assuming the national death rates in England and a population size of 1000.</figcaption>
</figure>
</div>
<p>This is a regression task. We want to smooth over the data – the models aren’t being used for prediction. I tried to design a model that captures as much of the true variation in the data as possible using epidemiological knowledge to choose plausible effects. In other words, the model is “full”, with enough parameters to capture all the true variability. The downside of this approach is that models with more parameters are harder to fit, whereas models with fewer parameters, or parsimonious models, make Bayesian inference easier but can mask some of the variance.</p>
</section>
<section id="inference" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="inference"><span class="header-section-number">3.4</span> Inference</h2>
<p>The decision was made early in the PhD to use Markov chain Monte Carlo (MCMC) sampling methods for inference, as this is the “gold standard” with guarantees that the sequence of samples will asymptotically converge to the true posterior. Furthermore, the state-of-the-art approximate inference package for spatial models, INLA, scales badly with the number of hyperparameters, and hence would struggle with the high dimensionality of the models in this thesis.</p>
<p>Bayesian models are specified in a probabilistic programming language. The starting point for this project was the <code>NIMBLE</code> package <span class="citation" data-cites="devalpineNIMBLEMCMCParticle2022 devalpineProgrammingModelsWriting2017">(<a href="../references.html#ref-devalpineNIMBLEMCMCParticle2022" role="doc-biblioref">de Valpine et al., 2022</a>, <a href="../references.html#ref-devalpineProgrammingModelsWriting2017" role="doc-biblioref">2017</a>)</span>. <code>NIMBLE</code> uses the BUGS (“Bayesian inference Using Gibbs Sampling”) syntax for defining a hierarchical model, which my research group has a lot of experience with, as <code>WinBUGS</code>, one of the earliest software packages for Bayesian analysis, was developed largely in the department for use on SAHSU studies. <code>NIMBLE</code> has an <code>R</code> interface but compiles models to <code>C++</code> for speed and scalability. It also increases the sampling efficiency by automatically finding conjugate relationships between parameters in the model and marginalising over them wherever possible. The group also has a close relationship with the lead developer of <code>NIMBLE</code>.</p>
<p>Nevertheless, Bayesian inference is difficult to scale, and some of the models in this thesis had in excess of <span class="math inline">\(10^6\)</span> parameters and took <code>NIMBLE</code> between 10 and 14 days to collect enough posterior samples. One of the main issues with <code>NIMBLE</code> was that the vast majority of the parameters in the model could not exploit efficient conjugate samplers, and instead used variants of basic Metropolis-Hastings samplers, which, despite numerous efforts at tuning, were inefficient. Although <code>NIMBLE</code> could execute a reasonable number of samples per second, the MCMC chains were struggling to explore the posterior efficiently so the <em>effective</em> sample size per second was low. This is a common problem in spatial and spatiotemporal models, where the parameters are correlated by design. To overcome these mixing issues, the chains had to be run for longer and thinned (i.e.&nbsp;take every <span class="math inline">\(n^{\text{th}}\)</span> sample so the Markov chain samples are closer to independent, which is better for computational reasons than storing a large number of correlated samples).</p>
<p>I spent a lot of time trying different probabilistic programming languages across <code>R</code>, <code>python</code> and <code>Julia</code>, in particular packages that implemented the more efficient No U-Turn Sampler (NUTS) <span class="citation" data-cites="rashidProbabilisticprogrammingpackages2022">(<a href="../references.html#ref-rashidProbabilisticprogrammingpackages2022" role="doc-biblioref">Rashid, 2022</a>)</span>. In the end, I settled on <code>NumPyro</code> <span class="citation" data-cites="phanComposableEffectsFlexible2019">(<a href="../references.html#ref-phanComposableEffectsFlexible2019" role="doc-biblioref">Phan et al., 2019</a>)</span> because it was the fastest and inference could be performed on a GPU, rather than CPUs, which is faster for large models <span class="citation" data-cites="laoTfpMcmcModern2020">(<a href="../references.html#ref-laoTfpMcmcModern2020" role="doc-biblioref">Lao et al., 2020</a>)</span>. The major downside was that <code>NumPyro</code> had not been used extensively by the spatial modelling community, so I had to implement the CAR distribution from <a href="Chapter2.html#eq-CAR-prec">Equation&nbsp;<span>2.2</span></a> myself, which has since been contributed to the source code <span class="citation" data-cites="numpyrodocumentationCARDistribution2023">(<a href="../references.html#ref-numpyrodocumentationCARDistribution2023" role="doc-biblioref">NumPyro documentation, 2023</a>)</span>. Rewriting the model in <code>NumPyro</code> and sampling on a GPU cut the runtime down to around a day. <code>NumPyro</code> also has built-in methods for approximate variational inference, such as the Laplace approximation, but these failed to converge to sensible values for these models without heavy customisation of variational function, so I stuck with sampling methods.</p>
</section>
<section id="clean-code-and-open-source" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="clean-code-and-open-source"><span class="header-section-number">3.5</span> Clean code and open source</h2>
<p>I am strong believer in open source science, and I have put a lot of attention into open sourcing code for all analyses during the PhD. With open science, not only do we facilitate the scientific method as our process and results are transparent, but we also allow future researchers to reuse and build on our models easily. It can also generate interest from researchers in different fields using similar models and from developers looking to challenge their software on complicated research questions, both of which I have seen first-hand during the course of my studies. The code is clean, version-controlled and follows best practices for scientific software engineering. As well as code contributed to open source projects along the way, the code for <a href="https://github.com/theorashid/mortality-statsmodel">statistical models</a>, <a href="https://github.com/theorashid/thesis-analysis">plots and analysis</a>, and the <a href="https://github.com/theorashid/thesis">thesis itself</a> can be found on GitHub.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-devalpineNIMBLEMCMCParticle2022" class="csl-entry" role="listitem">
de Valpine P, Paciorek CJ, Turek D, Michaud N, Anderson-Bergman C, Obermayer F, Wehrhahn Cortes C, Rodrìguez A, Lang DT, Paganin S, Hug J. 2022. <span>NIMBLE</span>: <span>MCMC</span>, <span>Particle Filtering</span>, and <span>Programmable Hierarchical Modeling</span>.
</div>
<div id="ref-devalpineProgrammingModelsWriting2017" class="csl-entry" role="listitem">
de Valpine P, Turek D, Paciorek CJ, Anderson-Bergman C, Lang DT, Bodik R. 2017. Programming <span>With Models</span>: <span>Writing Statistical Algorithms</span> for <span>General Model Structures With NIMBLE</span>. <em>Journal of Computational and Graphical Statistics</em> <strong>26</strong>:403–413. doi:<a href="https://doi.org/10.1080/10618600.2016.1172487">10.1080/10618600.2016.1172487</a>
</div>
<div id="ref-laoTfpMcmcModern2020" class="csl-entry" role="listitem">
Lao J, Suter C, Langmore I, Chimisov C, Saxena A, Sountsov P, Moore D, Saurous RA, Hoffman MD, Dillon JV. 2020. Tfp.mcmc: <span>Modern Markov Chain Monte Carlo Tools Built</span> for <span>Modern Hardware</span>. doi:<a href="https://doi.org/10.48550/arXiv.2002.01184">10.48550/arXiv.2002.01184</a>
</div>
<div id="ref-ministryofhousingcommunities&amp;localgovernmentEnglishIndicesDeprivation2019" class="csl-entry" role="listitem">
Ministry of Housing, Communities &amp; Local Government. 2019. English indices of deprivation 2019. <em>Ministry of Housing, Communities &amp; Local Government</em>.
</div>
<div id="ref-numpyrodocumentationCARDistribution2023" class="csl-entry" role="listitem">
NumPyro documentation. 2023. <span>CAR</span> distribution. <em>NumPyro</em>.
</div>
<div id="ref-officefornationalstatistics2011CensusGeographies2022" class="csl-entry" role="listitem">
Office for National Statistics. 2022b. 2011 <span>Census</span> geographies. <em>Office for National Statistics</em>.
</div>
<div id="ref-officefornationalstatisticsUserGuideMortality2022" class="csl-entry" role="listitem">
Office for National Statistics. 2022a. User guide to mortality statistics. <em>Office for National Statistics</em>.
</div>
<div id="ref-officefornationalstatisticsLowerLayerSuper2021" class="csl-entry" role="listitem">
Office for National Statistics. 2021b. Lower layer <span>Super Output Area</span> population estimates. <em>Office for National Statistics</em>.
</div>
<div id="ref-officefornationalstatisticsMiddleLayerSuper2021" class="csl-entry" role="listitem">
Office for National Statistics. 2021a. Middle layer <span>Super Output Area</span> population estimates. <em>Office for National Statistics</em>.
</div>
<div id="ref-officefornationalstatisticsPopulationEstimatesOutput2021" class="csl-entry" role="listitem">
Office for National Statistics. 2021c. Population estimates by output areas, electoral, health and other geographies, <span>England</span> and <span>Wales</span>. <em>Office for National Statistics</em>.
</div>
<div id="ref-phanComposableEffectsFlexible2019" class="csl-entry" role="listitem">
Phan D, Pradhan N, Jankowiak M. 2019. Composable <span>Effects</span> for <span>Flexible</span> and <span>Accelerated Probabilistic Programming</span> in <span>NumPyro</span>. doi:<a href="https://doi.org/10.48550/arXiv.1912.11554">10.48550/arXiv.1912.11554</a>
</div>
<div id="ref-rashidProbabilisticprogrammingpackages2022" class="csl-entry" role="listitem">
Rashid T. 2022. Probabilistic-programming-packages.
</div>
<div id="ref-vandijkUsingLinkedConsumer2021" class="csl-entry" role="listitem">
van Dijk JT, Lansley G, Longley PA. 2021. Using linked consumer registers to estimate residential moves in the <span>United Kingdom</span>. <em>Journal of the Royal Statistical Society: Series A (Statistics in Society)</em> <strong>184</strong>:1452–1474. doi:<a href="https://doi.org/10.1111/rssa.12713">10.1111/rssa.12713</a>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Chapters/Chapter2.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Background</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../Chapters/Chapter4.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Small: Life expectancy trends in England at the MSOA level</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>