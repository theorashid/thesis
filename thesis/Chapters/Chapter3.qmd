# The model {#sec-Chapter3}

## The data

Same dataset for each
By age + sex, log scale
Age specific and Life expectancy male and female over time
Colour geom_tile plot
PCA for age (Alexander)
Death rate 2002-19 by district

### Other data sources

Population data from ONS.
Estimates, modelled for inter-censal years using births, deaths, migration
The mid-2020 Small Area population estimates covered by this bulletin are fully consistent with population estimates for higher levels of geography including local authorities, regions and the national total for England and Wales.
https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/bulletins/annualsmallareapopulationestimates/latest
The description of the methodology in the following sections uses the example of creating rolled-forward mid-2020 Lower layer Super Output Area (LSOA) estimates. For example, we produced the mid-2020 LSOA estimates using the mid-2019 LSOA estimates as the population base.
Middle layer Super Output Area (MSOA) estimates are created in a similar manner using derived MSOA quinary age-by-sex change ratios and are constrained to local authority mid-year estimates.
Change ratios were calculated by quinary age group and sex for the patient register data. The change ratios are calculated by dividing for each dataset the mid-2020 count by quinary age and sex by the mid-2019 count by quinary age and sex. For example, a mid-2020 count of 50 divided by a mid-2019 count of 40 gives a change ratio of 1.25.
The ratios are then constrained to the mid-2020 MSOA estimates (less mid-2020 special population), which have been constrained to the local authority mid-2020 estimates less mid-2020 special population.
The number of patients registered on GP lists in each OA at the mid-year point is used as a proxy for the true size of the population at the same point in time.

IMD data
Focus on income, education, – not health
Aggregate to different geographies
map of IMD for London (LSOA), and IMD for England (MSOA) in 2019

## Model

Why we model? Robust estimates
Explanation of death rates, small numbers, zero population, variability
Regression, statistical smoothing
Same model

As complex a model as possible, capture as more variation
"Full" model
More parameters is harder to fit, fewer parameters makes inference easier
Models are overspecified, like Bayesian neural networks (AGW paper)

## Inference

Choice made to do sampling – gold standard
Approximate inference state-of-the-art for spatial models, INLA, scales badly with the number of effects

Start with NIMBLE, group has experience with BUGS
Gibbs sampling, finds conjugate relationships where they exist
R interface but C++ backend, scales well to a large problem like this

Move to numpyro.
Created CAR distribution, contributed to open source
Sampling faster, more efficient NUTS
Sampling on GPU, much faster
Tried VI methods in numpyro, such as laplace approx, but failed to converge to sensible values

